CREATE DEFINER=`b2bcollabportal`@`%` PROCEDURE `Update_procedure`()
BEGIN

update B2B_UAT.forecast_plan join B2B_UAT.staging on
B2B_UAT.forecast_plan.id=B2B_UAT.staging.id
set
	B2B_UAT.forecast_plan.bu=B2B_UAT.staging.bu,
	B2B_UAT.forecast_plan.buffer=B2B_UAT.staging.buffer,
	B2B_UAT.forecast_plan.build_type=B2B_UAT.staging.build_type,
	B2B_UAT.forecast_plan.division=B2B_UAT.staging.division,
	B2B_UAT.forecast_plan.date=B2B_UAT.staging.date,
	B2B_UAT.forecast_plan.dmp_orndmp=B2B_UAT.staging.dmp_orndmp,
	B2B_UAT.forecast_plan.is_dmp=B2B_UAT.staging.is_dmp,
	B2B_UAT.forecast_plan.description=B2B_UAT.staging.description,
	B2B_UAT.forecast_plan.forecast_original=B2B_UAT.staging.forecast_original,
	B2B_UAT.forecast_plan.planner_name=B2B_UAT.staging.planner_name,
	B2B_UAT.forecast_plan.gsa_original=B2B_UAT.staging.gsa_original,
	B2B_UAT.forecast_plan.nongsa_original=B2B_UAT.staging.nongsa_original,
	B2B_UAT.forecast_plan.source_supplier=B2B_UAT.staging.source_supplier,
	B2B_UAT.forecast_plan.item_type=B2B_UAT.staging.item_type,
	B2B_UAT.forecast_plan.org=B2B_UAT.staging.org,
	B2B_UAT.forecast_plan.planner_code=B2B_UAT.staging.planner_code,
	B2B_UAT.forecast_plan.product_family=B2B_UAT.staging.product_family,
	B2B_UAT.forecast_plan.nongsa_commit=0,
    B2B_UAT.forecast_plan.nongsa_de_commit=0,
    B2B_UAT.forecast_plan.gsa_commit=0,
    B2B_UAT.forecast_plan.gsa_de_commit=0,
    B2B_UAT.forecast_plan.forecast_commit=0,
    B2B_UAT.forecast_plan.forecast_de_commit=0,
    B2B_UAT.forecast_plan.system_commit=0,
    B2B_UAT.forecast_plan.system_de_commit=0,
	B2B_UAT.forecast_plan.nongsa_advance_commit_irp=0,
    B2B_UAT.forecast_plan.gsa_advance_commit_irp=0,
    B2B_UAT.forecast_plan.forecast_advance_commit_irp=0,
    B2B_UAT.forecast_plan.system_advance_commit_irp=0,
    B2B_UAT.forecast_plan.is_escalated=0,
    B2B_UAT.forecast_plan.cumulative_forecast_advance_commit_irp=B2B_UAT.staging.cumulative_forecast_advance_commit_irp,
    B2B_UAT.forecast_plan.cumulative_gsa_advance_commit_irp=B2B_UAT.staging.cumulative_gsa_advance_commit_irp,
    B2B_UAT.forecast_plan.cumulative_nongsa_advance_commit_irp=B2B_UAT.staging.cumulative_nongsa_advance_commit_irp,
    B2B_UAT.forecast_plan.cumulative_system_advance_commit_irp=B2B_UAT.staging.cumulative_system_advance_commit_irp,
	B2B_UAT.forecast_plan.cid_mapped_part_number=B2B_UAT.staging.cid_mapped_part_number,
	B2B_UAT.forecast_plan.cal_option=B2B_UAT.staging.cal_option,
	B2B_UAT.forecast_plan.dept_code=B2B_UAT.staging.dept_code,
	B2B_UAT.forecast_plan.last_week_data=B2B_UAT.staging.last_week_data,
	B2B_UAT.forecast_plan.updated_at=current_timestamp(),
	B2B_UAT.forecast_plan.process_week=WEEKOFYEAR(CURDATE()),
	B2B_UAT.forecast_plan.process_year=year(current_date()),
	B2B_UAT.forecast_plan.updated_by=1,
    B2B_UAT.forecast_plan.product_line=B2B_UAT.staging.product_line,
    B2B_UAT.forecast_plan.finished_goods=B2B_UAT.staging.finished_goods,
    B2B_UAT.forecast_plan.measurable=B2B_UAT.staging.measurable,
    B2B_UAT.forecast_plan.countable=B2B_UAT.staging.countable,
    B2B_UAT.forecast_plan.cm_part_number=B2B_UAT.staging.cm_part_number,
    B2B_UAT.forecast_plan.instrument=B2B_UAT.staging.instrument,
    B2B_UAT.forecast_plan.buffer_opt_adj=B2B_UAT.staging.buffer_opt_adj,
    B2B_UAT.forecast_plan.on_hand_total_cm=B2B_UAT.staging.on_hand_total_cm,
    B2B_UAT.forecast_plan.on_hand_nettable_si=B2B_UAT.staging.on_hand_nettable_si,
    B2B_UAT.forecast_plan.current_open_po=B2B_UAT.staging.current_open_po,
    B2B_UAT.forecast_plan.past_due_open_po=B2B_UAT.staging.past_due_open_po,
    B2B_UAT.forecast_plan.prod_year_week=B2B_UAT.staging.prod_year_week,
    B2B_UAT.forecast_plan.oripartnumber_week_year=concat(B2B_UAT.forecast_plan.ori_part_number,'-',B2B_UAT.forecast_plan.prod_week,'-',B2B_UAT.forecast_plan.prod_year),
    B2B_UAT.forecast_plan.prod_year_month=B2B_UAT.staging.prod_year_month,
    B2B_UAT.forecast_plan.source_supplier_id=B2B_UAT.staging.source_supplier_id,
    B2B_UAT.forecast_plan.received_qty=B2B_UAT.staging.received_qty,
    B2B_UAT.forecast_plan.active=1,
    B2B_UAT.forecast_plan.old_data=0;
    
truncate B2B_UAT.staging;

END